预埋单记录面板
---------------------

.. note:: 目前功夫系统支持 **批量预埋单** 、 **下单笔预埋单** 以及 **预埋撤单** 。

   - **批量预埋单**：盘休时下出，开盘后下出多个普通委托。
   - **下单笔预埋单**：盘休时下出，开盘后下出一个普通委托。
   - **预埋撤单**：盘休时下出，开盘后撤单原来（盘休前）正在交易的订单。
   - **撤单**： 未触发的预埋单、预埋撤单，均可撤单。

.. image:: _images/预埋单面板-25.png

.. image:: _images/预埋单记录-27.png



-----

添加预埋单面板
~~~~~~~~~~~~~~~~~
如需使用 **批量预埋** 功能，请手动添加“预埋单记录”面板以更好地追踪预埋单、预埋撤单实现情况。

(1) 点击“添加”按钮

(2) 选择“预埋单记录”进行添加。

.. note::目前预埋单仅适配 **ctp、融航（rongh）** 柜台，使用其他柜台时，无法使用预埋单功能

.. image:: _images/预埋单记录-添加预埋单记录面板.png

.. note:: 预埋单表格字段含义请参考以下表格。

.. list-table::
   :header-rows: 1

   * - 字段
     - 字段说明
   * - 类型
     - 下单/撤单。下单：预埋单，开盘后下出普通委托。撤单：预埋撤单，开盘后撤单盘休前正在交易的订单
   * - 生成时间
     - 指下出预埋单/预埋撤单的时间
   * - 标的
     - 标的代码
   * - 表头为空（买卖）
     - 该笔委托的方向：买or卖
   * - 表头为空（开平）
     - 该笔委托的方向：开or平
   * - 委托价
     - 预埋单：触发后，预埋单下出普通委托的委托价；  预埋撤单：待撤订单的原委托价
   * - 委托量
     - 预埋单：触发后，预埋单下出普通委托的委托量；  预埋撤单：待撤订单的原委托价
   * - 触发时间
     - 指预埋单触发的时间
   * - 订单状态
     - 未触发：预埋单/预埋撤单已由系统发出，等待开盘后触发；已触发：预埋单/预埋撤单。由于柜台不对预埋单进行验资，需要关注回报信息，若因仓位/资金不足导致触发时下单失败，虽然预埋单状态仍然为已触发，但不会生成对应的普通委托单；已取消：预埋单/预埋撤单报单成功后，用户自主操作了撤销预埋单/预埋撤单且撤单成功
   * - 回报信息
     - 预埋单/预埋撤单报单成功时，显示“成功”。若为其他内容，表示预埋单/预埋撤单失败，可从回报信息查看报单失败的原因。
   * - 下单源
     - 手动

-----



下单笔预埋单
~~~~~~~~~~~~~~~~~~

.. note:: 
   - 当预埋单被触发后，将生成对应的普通委托。
   - 两个委托相互独立。预埋单已触发即为预埋单的最终状态，不再更新，请在“委托记录”面板跟踪其触发的普通委托单。

(1) 在下单面板输入想要预埋的标的，点击预埋并确认预埋信息。

.. image:: _images/预埋单记录-单笔预埋单.png

(2) 预埋后，可在“预埋单记录”面板查看刚才预埋的记录。

.. image:: _images/预埋单记录-单笔预埋单2.png

(3) 开盘后，预埋单被触发。此时预埋单将生成一条委托记录，并在“委托记录”面板显示。

.. image:: _images/预埋单记录-单笔预埋单3.png

.. attention::

   - 预埋单仅允许在盘休时刻下单，盘中下预埋单将被交易所拒绝。
  
   - 若开盘后，预埋单状态未更新，仍然为“待触发”，请点击刷新按钮更新预埋单状态。

-----

批量下预埋单
~~~~~~~~~~~~~~~~~~~~

(1) 点击预埋单记录面板的“批量”按钮。

.. image:: _images/预埋单记录-批量预埋单1.png

(2) 点击“下载模板”。

(3) 根据弹窗上的提示文本修改模板，修改完成后回到客户端点击“导入csv”。

(4) 回显到弹窗中，用户可进行二次调整，确认信息无误后点击“确定”。

.. image:: _images/预埋单记录-批量预埋单2.png

(5) 预埋后，可在“预埋单记录”面板查看刚才预埋的记录。

.. image:: _images/预埋单记录-预埋单记录面板展示.png

(6) 开盘后，预埋单被触发。此时预埋单将生成多条委托记录，并在“委托记录”面板显示。

.. image:: _images/预埋单记录-预埋单记录面板展示（已触发）.png


.. error:: 如果导入失败，请核对是否出现了以下情况
  
   -  csv中包含标的为空的行。
    
   -  买卖开平列未按规则填写（规则：填写0或1）。
  

-----

.. attention::  预埋撤单 ≠ 撤单预埋单

  :ref:`预埋撤单 <下单笔预埋撤>` 对盘休前正在交易的单子进行撤单（可在委托记录面板中通过“预撤”按钮快速下出）。

  :ref:`撤单预埋单或预埋撤单 <撤单预埋单>` 下出预埋单/预埋撤单后，在未开盘前，撤销下出的预埋单/预埋撤单。



.. _撤单预埋单:

取消单笔预埋单
~~~~~~~~~~~~~~~~~~~~~~~~~


(1) “预埋单记录”面板点击“撤单”按钮。

.. image:: _images/预埋单记录-单笔撤单.png

(2) 预埋单状态变为待撤，等待开盘后撤单行为触发。

.. image:: _images/预埋单记录-单笔撤单2.png

(3) 开盘后，预埋单的撤单回报返回，状态变为“已撤单”时，撤单完成。

.. image:: _images/预埋单记录-单笔撤单3.png


.. warning::为什么订单状态一直停留在“待撤”？

  - 预埋单的撤单与普通委托相同，非实时完成。因此在盘休时，撤单回报虽然已由系统发出，但交易所暂未处理撤单委托，因此状态将停留在“待撤”。

  - 若开盘后，预埋单状态未更新，仍然为“待撤”，可能是撤单回报丢失导致的。请点击刷新按钮即更新预埋单状态。

-----


.. _下单笔预埋撤:

下单笔预埋撤单
~~~~~~~~~~~~~~~~



(1) “委托记录”面板点击“预撤”按钮（当该订单目前没有未触发的预埋撤单时，按钮为灰色）。

.. image:: _images/预埋单记录-预撤1.png

(2) “预撤”按钮亮起，并在“预埋单记录"面板生成一条预埋撤单的记录。

.. image:: _images/预埋单记录-预撤2.png

(3) 开盘后，预埋撤单被触发。“预埋单记录”面板的预埋撤单委托状态变为“已触发”。并且此时“委托记录”面板的该委托订单状态为已撤单。

.. image:: _images/预埋单记录-预撤3.png


-----


取消单笔预埋撤单
~~~~~~~~~~~~~~~~~~~~~~
.. note:: 取消预埋撤单有2个方式 :ref:`通过委托记录面板 <委托记录面板取消预埋撤单>`、:ref:`通过预埋单记录面板 <预埋单记录面板取消预埋撤单>`  。


.. _委托记录面板取消预埋撤单:


- **方法1：从委托记录面板取消预埋撤单**
  
(1) 点击亮起的预埋撤单按钮，确认进行撤销预埋撤单。

.. image:: _images/委托记录-预埋单撤单方法1.png

(2) 预撤按钮置灰，且“预埋单记录”面板中对应下出的预埋撤单订单状态将变为“待撤”。

.. image:: _images/委托记录-预埋单撤单方法2.png

(3) 开盘后，预埋撤单触发，此时“预埋单记录”中对应的预埋撤单订单状态由“待撤”变为“已取消”。

.. image:: _images/委托记录-预埋单撤单方法3.png


.. _预埋单记录面板取消预埋撤单:

- **方法2：从预埋单记录面板取消预埋撤单**


(1) 点击订单状态为“未触发”预埋撤单后方的撤单按钮。

.. image:: _images/委托记录-预埋单撤单方法4.png

(2) “预埋单记录”面板中对应下出的预埋撤单订单状态将变为“待撤”。

.. image:: _images/委托记录-预埋单撤单方法5.png

(3) 开盘后，预埋撤单触发，此时“预埋单记录”中对应的预埋撤单订单状态由“待撤”变为“已取消”。

.. image:: _images/委托记录-预埋单撤单方法6.png

-----